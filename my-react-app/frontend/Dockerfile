# ğŸ“¦ à¸‚à¸±à¹‰à¸™à¸•à¸­à¸™à¸—à¸µà¹ˆ 1: à¹ƒà¸Šà¹‰ Node.js à¹ƒà¸™à¸à¸²à¸£ build Vite project
FROM node:18 AS builder

# ğŸ“ à¸ªà¸£à¹‰à¸²à¸‡à¹‚à¸Ÿà¸¥à¹€à¸”à¸­à¸£à¹Œà¸—à¸³à¸‡à¸²à¸™
WORKDIR /app

# ğŸ“„ à¸à¹Šà¸­à¸›à¹„à¸Ÿà¸¥à¹Œà¹à¸à¹‡à¸à¹€à¸à¸ˆà¹€à¸‚à¹‰à¸²à¸¡à¸²à¹à¸¥à¸°à¸•à¸´à¸”à¸•à¸±à¹‰à¸‡ dependencies
COPY package*.json ./
RUN npm install

# ğŸ“‚ à¸à¹Šà¸­à¸› source code à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”à¹€à¸‚à¹‰à¸²à¸¡à¸²
COPY . .

# âš™ï¸ à¸ªà¸±à¹ˆà¸‡ build frontend â†’ à¸ˆà¸°à¹„à¸”à¹‰à¹‚à¸Ÿà¸¥à¹€à¸”à¸­à¸£à¹Œ dist/
RUN npm run build

# ----------------------------------------------------------------

# ğŸŒ à¸‚à¸±à¹‰à¸™à¸•à¸­à¸™à¸—à¸µà¹ˆ 2: à¹ƒà¸Šà¹‰ nginx serve frontend à¹à¸šà¸š production
FROM nginx:stable-alpine

# ğŸ§¹ à¸¥à¸š default config à¸—à¸µà¹ˆ nginx à¹ƒà¸«à¹‰à¸¡à¸²
RUN rm -rf /usr/share/nginx/html/*

# ğŸ“‚ à¸„à¸±à¸”à¸¥à¸­à¸à¹„à¸Ÿà¸¥à¹Œ build à¸¡à¸²à¹„à¸§à¹‰à¸—à¸µà¹ˆ nginx serve
COPY --from=builder /app/dist /usr/share/nginx/html

# âš™ï¸ à¸„à¸±à¸”à¸¥à¸­à¸à¹„à¸Ÿà¸¥à¹Œ config nginx (à¸«à¸²à¸à¸„à¸¸à¸“à¸¡à¸µà¹à¸šà¸š custom)
# COPY nginx.conf /etc/nginx/conf.d/default.conf

# ğŸŒ à¹€à¸›à¸´à¸”à¸à¸­à¸£à¹Œà¸• 80
EXPOSE 80

# â–¶ï¸ à¸„à¸³à¸ªà¸±à¹ˆà¸‡à¹€à¸£à¸´à¹ˆà¸¡ nginx
CMD ["nginx", "-g", "daemon off;"]
